<!DOCTYPE html>
<html><head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

    <title>April GPU - April - APL embedded in Common Lisp</title>

    
    
    <meta name="description" content="Getting April to use a GPU Current state of affairs We live in days where there are constant wonders/horrors in the area of Machine Learning. For a long time this been the domain of a handful of tools.
python numpy scipy jupyter ipython tensorflow torch pandas matplotlib rapids All of the above, but only for CUDA GPU&rsquo;s and optimized to keep the computations in GPU RAM. Where April fits in April is just a APL compiler." />
    <meta name="author" content="" />
    

    <link href="https://unpkg.com/@master/normal.css" rel="stylesheet">
    <script src="https://unpkg.com/@master/style@1.5.0"></script>
    <script src="https://unpkg.com/@master/styles@1.13.0"></script>
    <script src="https://unpkg.com/master-styles-group"></script>
    <script src="https://unpkg.com/themes.js"></script>
    <script>window.themes = window.themes || new window.Themes()</script>

    <style>
        :root {
            --font-sans: "Inter var", ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Helvetica Neue, Arial, Noto Sans, sans-serif, Apple Color Emoji, Segoe UI Emoji, Segoe UI Symbol, Noto Color Emoji;
        }
    </style></head>
<body class="bg:fade-84@dark font:fade-16@dark font:sans">
    <nav class="w:full h:90 fixed bg:fade-84/.95@dark bg:white z:1000">
    <div class="
        h:full
        w:full
        max-w:1200
        mx:auto
        px:32
        d:flex
        align-items:center
    ">
        <div>
            <a href="/" class="mr-3 font:extralight">
              
              April - APL embedded in Common Lisp
              
            </a>
        </div>

        <div class="ml:auto">
            
            
            
        </div>
    </div>
</nav>
<div class="d:flex flex:column@<=sm pt:90 px:24 jc:center gap:44 word-break:break-word">
        <div class="max-w:700 w:full box:content-box">
<article class="box:border-box pt:32">
    <header class="mb:32">
        <div class="font:40 font:extrabold">April GPU</div>
        <div class="mt:16 f:fade-60">
            <time>Jul 9, 2023</time>
            </div>
    </header><div class="
    _:where(a):hover{text-decoration-color:fade}
    _:where(a){text-decoration:2;underline;fade-10;_text-decoration-color:fade-70@dark}
    _:where(blockquote){bl:5;solid;fade-76/.1;_bl:5;solid;fade-34/.1@dark}
    _:where(code){font:90%;_v:middle}
    _:where(code:not(.highlight_*,pre_*)){p:2;6;_r:4}
    _:where(del){text-decoration:1;line-through;fade-68;_text-decoration-color:red-64@dark}
    _:where(figcaption){text:14;_p:10;20;0;_width:fit;_mx:auto;_font:fade-56;_font:fade-57@dark}
    _:where(h1){font:40;_font:extrabold}
    _:where(h1,h2,h3)+:where(h1,h2,h3){mt:.5em}
    _:where(h1,h2,h3,h4,h5,h6){mt:2em}
    _:where(h2){mb:1em;_font:32}
    _:where(h3){font:24}
    _:where(h4){font:20}
    _:where(h5){font:16}
    _:where(h6){font:14}
    _:where(li)::marker{font:fade-44;_font:fade-68@dark}
    _:where(li){pl:.375em}
    _:where(mark){text-decoration:1;underline;#fce016;_bg:transparent;_text-decoration-color:rgb(252;224;22/.5)@dark}
    _:where(p,li){font:fade-76;_font:16;_line-height:1.65;_font:fade-34@dark}
    _:where(p,pre,blockquote,figure,ul,ol,table){my:1.125em}
    >:first-child{mt:0!}
    _:where(pre){p:20;_r:8;_overflow:auto}
    _:where(pre,code:not(.highlight_*)){bg:fade-2;_bg:fade-92!@dark}
    _:where(strong,b,a,code:not(.highlight_*),mark,del){font:fade-92;_font:fade-12@dark}
    _:where(table){width:full;_border-spacing:0}
    _:where(td){v:baseline}
    _:where(td,th):first-child{pl:0}
    _:where(td,th):last-child{pr:0}
    _:where(td,th){bb:1;solid;fade-92/.06;_p:6;_b:fade-4/.04@dark}
    _:where(th){font:fade-78;_font:14;_text:left;_font:fade-12@dark}
    _:where(th,p_code,li_code,a,mark){font:semibold;_font:medium@dark}
    _:where(ul){list-style-type:disc}
    _:where(ul,ol,blockquote){pl:1.5em}
    _:where(video,img){max-width:full}
    _:where(a,mark){text-underline-offset:3}
    _:where(hr){h:2;_bg:fade-10;_bg:fade-70@dark;_my:3em}
"><h2 id="getting-april-to-use-a-gpu">Getting April to use a GPU</h2>
<h3 id="current-state-of-affairs">Current state of affairs</h3>
<p>We live in days where there are constant wonders/horrors in the area of Machine Learning.
For a long time this been the domain of a handful of tools.</p>
<ul>
<li>python
<ul>
<li>numpy</li>
<li>scipy</li>
</ul>
</li>
<li>jupyter
<ul>
<li>ipython</li>
<li>tensorflow</li>
<li>torch</li>
<li>pandas</li>
<li>matplotlib</li>
</ul>
</li>
<li>rapids
<ul>
<li>All of the above, but only for CUDA GPU&rsquo;s and optimized to keep the computations in GPU RAM.</li>
</ul>
</li>
</ul>
<h3 id="where-april-fits-in">Where April fits in</h3>
<p>April is just a APL compiler. At the moment it does a pretty good job of compiling APL on
the CPU and uses multiple cores. For most traditional APL programming this is probably
enough. But that is not why I got interested. I see the potential for using it as a tool
for Machine learning. I am a mathematician and today&rsquo;s libraries hide what is going on
inside. APL hides nothing. It is just a terse language for doing (mostly) linear
algebra. As such it fits a niche. People like me who want to understand what the machine is
doing when learning, not just cutting and pasting from online examples and hoping for the
best. For handling the huge arrays we see in Machine Learning fast enough we are going to
need to use the GPU.</p>
<h3 id="how-do-we-do-it">How do we do it</h3>
<p>April is the work of few people with limited time and resources. As such a huge cross
platform solution like <a href="https://www.modular.com/mojo">mojo</a> was out of the question.
Also I didn&rsquo;t want Vendor lock in and only rely on NVIDIA CUDA. In my research I also came
across Vulcan. I started to realize that shaders can be general compute nodes, just like
CUDA threads. Also it is possible to set up a compute pipeline in Vulcan without graphics
output. In fact displaying graphics is a extension in Vulcan and not part of the Vulcan
core.</p>
<p><img src="/images/spir.jpg" alt="targets"></p>
<p>Vulcan accesses shaders in a binary cross platform format called SPIR-V.
SPIRV-V is compiled to native code on the platform. It can be computed on AMD, NVIDIA and
on MAC&rsquo;s with Metal. SPIR-V is also accessible trough OpenCL making work on devices like
<a href="https://www.xilinx.com/products/som/kria.html">XILINX Kria</a> which is a FPGA with ARM
cores and Mali. It can thus be used on mobile, desktop and robotics platforms.
Pretty cool!</p>
<h3 id="overall-design">Overall design</h3>
<p>This is all a preliminary sketch. None of this has been build yet. Nevertheless I have a
idea of how the structure is going to be.</p>
<p>Here is a sketch of the design.</p>
<p><img src="/images/april-gpu.svg" alt="targets"></p>
<h3 id="gpu-pipeline">GPU pipeline</h3>
<p>This follows rather rigid design dictated by Vulkan.</p>
<p>Here is a sketch of the design.</p>
<p><img src="/images/april-vulkan.svg" alt="targets"></p>
</div></article>
<footer class="py:24">
    <div class="f:fade-30 f:14 mb:8"></div>
    <div class="f:fade-60 f:12">Theme <a class="f:bold" href="https://github.com/serkodev/holy" _target="_blank">Holy</a></div>
</footer></div>
    </div>
</body>

</html>